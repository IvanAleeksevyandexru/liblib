<div class="user-menu show">
  <div #menuDesk class="menu-desk container hide show-lg" [class.show]="showDeskView()">
    <perfect-scrollbar [config]="{suppressScrollX: true, wheelPropagation: false}">
      <ng-template *ngTemplateOutlet="menuHeader"></ng-template>
      <ng-template *ngTemplateOutlet="menuTabs"></ng-template>
      <ul class="user-menu-links">
        <li class="item">
          <a [href]="" (click)="menuStaticItemClick('HEADER.MENU.SETTINGS_MENU', 'settingsSecurity')">{{'HEADER.MENU.SETTINGS_MENU' | libTranslate}}</a>
          <lib-counter class="counter" [counter]="settingsCounter"></lib-counter>
        </li>
        <li class="item" *ngIf="!user.isKid">
          <a [href]="" (click)="menuStaticItemClick('HEADER.MENU.LOGIN_ORG', 'loginAsOrganization')">{{titleChangeRole | libTranslate}}</a>
        </li>
      </ul>
      <ul class="user-menu-links" *ngIf="!user.isKid">
        <li class="item">
          <a [href]="" (click)="logout()">{{'HEADER.EXIT' | libTranslate}}</a>
        </li>
      </ul>
    </perfect-scrollbar>
  </div>

  <div #menuMobile class="menu-mobile container hide-lg" [class.hide-menu-when-search]="!showAllMenu" [class.show]="showMobileView()">
    <ng-template *ngTemplateOutlet="menuHeader"></ng-template>
    <div *ngIf="searchSputnikEnabled" class="hide-lg show-md hide-sm menu-search-container">
      <lib-search-sputnik
        (opened)="showAllMenu = false"
        (closed)="showAllMenu = true"
        contextClass="menu-search"
        placeholder="Поиск"
        [useGlobalPlaceholder]="false">
      </lib-search-sputnik>
    </div>
    <ng-container *ngIf="showAllMenu">
    <ng-template *ngTemplateOutlet="menuTabs"></ng-template>
    <div class="item select-role" *ngIf="!user.authorized && rolesListEnabled" (click)="showRolesList = !showRolesList" [ngClass]="{'show-roles-list': showRolesList}">
      <span class="active-role">{{ (activeRole?.name) || 'Гражданам' }}</span>
    </div>
    <ul *ngIf="showRolesList" class="roles-list">
      <li class="item" *ngFor="let role of userRoles; let first = first">
        <a (click)="!role.isActive && role.click()"
           [ngClass]="{'active': role.isActive}"
           [href]="role.url">{{role.name | libTranslate}}</a>
      </li>
    </ul>
    <ul class="links-mobile" *ngIf="!user.isKid">
      <li class="item" *ngFor="let link of links">
        <a [href]="" (click)="menuItemClick(link.url, link.mnemonic)">{{link.title | appTranslate}}</a>
      </li>
    </ul>
    <ul class="links-mobile" *ngIf="!user.isKid">
      <li class="item" *ngIf="user.authorized">
        <a [href]="" (click)="menuStaticItemClick('HEADER.MENU.SETTINGS_MENU', 'settingsSecurity')">{{'HEADER.MENU.SETTINGS_MENU' | libTranslate}}</a>
        <lib-counter class="counter" [counter]="settingsCounter"></lib-counter>
      </li>
      <li class="item">
        <lib-location-select (click)="onClose()"></lib-location-select>
      </li>
      <li class="item" *ngIf="user.authorized">
        <a [href]="" (click)="menuStaticItemClick('HEADER.MENU.LOGIN_ORG', 'loginAsOrganization')">{{'HEADER.MENU.LOGIN_ORG' | libTranslate}}</a>
      </li>
    </ul>
    <ul *ngIf="user.authorized" class="links-mobile">
      <li class="item">
        <a [href]="" (click)="logout()">{{'HEADER.EXIT' | libTranslate}}</a>
      </li>
    </ul>
    </ng-container>
  </div>

  <div class="content-overlay" [class.show]="state.active"></div>
</div>


<ng-template #menuHeader>
  <div class="menu-header" [ngClass]="{'not-authorized': !user.authorized}">
    <div *ngIf="(loadService.avatar | async) as avatar" class="avatar-wrapper">
      <img *ngIf="avatar.url && !avatarError; else noAvatar" class="avatar" [src]="avatar.url" (error)="avatarError = true" alt=""/>
      <ng-template #noAvatar>
        <div
          class="no-avatar"
          [class.female]="avatar.gender === 'F'"
          [class.business]="user.type === 'B'"
          [class.legal]="user.type === 'L'"
        ></div>
      </ng-template>
    </div>
    <div class="name">
      <ng-container *ngIf="user.type === 'L'">{{(user.orgShortName || user.orgName)}}</ng-container>
      <ng-container *ngIf="user.type === 'B'">{{(user.orgShortName || 'ИП ' + user.shortName)}}</ng-container>
      <ng-container *ngIf="user.type !== 'B' && user.type !== 'L'">{{user.formattedName}}</ng-container>
    </div>
    <a class="close-menu" (click)="onClose()"></a>
  </div>
</ng-template>

<ng-template #menuTabs>
  <ul class="user-menu-tabs" *ngIf="mainTabs?.tabs?.length">
    <li class="item" *ngFor="let tab of mainTabs.tabs">
      <ng-container *ngIf="tab.url">
        <a (click)="selectTab(tab)" routerLink="{{tab.url}}"
           routerLinkActive="active">
          <span class="item-tab-name">{{tab.name | appTranslate}}</span>
          <lib-counter class="counter" [counter]="tab.counter"></lib-counter>
        </a>
      </ng-container>
    </li>
  </ul>
</ng-template>

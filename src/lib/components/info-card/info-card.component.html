<div
  [id]="object.attrId"
  class="info-card {{cardType}}"
  [ngClass]="{'interactive': object.canDetails || object.canEdit, 'form-container': cardType === 'modify', 'new': isNew}">
  <div class="inner">
    <ng-container *ngIf="cardType === 'common'" [ngTemplateOutlet]="common"></ng-container>
    <ng-container *ngIf="cardType === 'empty'" [ngTemplateOutlet]="empty"></ng-container>
    <ng-container *ngIf="cardType === 'modify'" [ngTemplateOutlet]="modify"></ng-container>
  </div>
</div>

<ng-template #empty>
  <div class="title">{{object.empty?.title}}</div>
  <div class="subtitle mt-16">{{object.empty?.subtitle}}</div>
  <div class="actions mt-16">
    <span *ngIf="!externalLink && !addPath" class="link-plain add-link" (click)="toggleForm()">Добавить</span>
    <a *ngIf="externalLink && !addPath" class="link-plain add-link" [routerLink]="[externalLink]">Добавить</a>
    <a *ngIf="addPath" class="link-plain add-link" [routerLink]="addPath">Добавить</a>
    <a *ngIf="object.serviceUrl" class="link-plain" (click)="toOrder()">Заказать услугу</a>
  </div>
</ng-template>

<ng-template #common>
  <div class="header {{['failed', 'process'].indexOf(state) === -1 && object.gender ? object.gender : ''}}">
    <div class="title">{{object.full.title}}</div>
    <div *ngIf="isNotificationShow()" [ngClass]="object.warning ? 'notification-red': 'notification'" class="confirm"></div>
    <div *ngIf="!isNew && (object.withVerificationIcon || state)" class="confirm {{state}}"></div>
    <div *ngIf="isNew && !isNotificationShow()" class="confirm new"></div>
  </div>
  <div class="fields mt-24 mt-md-28 mb-16" *ngIf="object.fields">
    <p *ngIf="stateText" class="text-plain state {{state}} mb-16" [innerHTML]="stateText | appTranslate"></p>
    <p *ngIf="isNotificationShow()"
       class="text-plain mb-16"
       [class.red]="object.warning"
       [class.green]="!object.warning && state !== 'verifying'"
       [class.gray]="state === 'verifying'"
       [innerHTML]="object.notification | appTranslate"
    ></p>
    <p *ngIf="object.statusMessage"
       [class.gray]="state === 'process'"
       [class.red]="state === 'error' || state === 'failed'"
       class="text-plain mb-16"
       [innerHTML]="object.statusMessage | appTranslate"
    ></p>
    <p *ngIf="typeOf(isNew) === 'string'"
       class="text-plain yellow mb-16"
       [innerHTML]="isNew | appTranslate"></p>
    <div class="field mt-16" *ngFor="let field of object.fields">
      <ng-container *ngIf="(field.value || field.showEmpty) && !field.hidden">
        <span *ngIf="!field.noLabel && field.title" class="text-plain gray">{{field.title}}</span>
        <span class="value text-plain black mt-8" [class.bold]="!field.title || field.bold" [class.primary]="field.noLabel" [innerHTML]="field.value"></span>
      </ng-container>
    </div>
  </div>
  <div class="card-actions">
    <ng-container [ngSwitch]="data.type">
      <ng-container *ngSwitchCase="'CHILD'">
        <a class="link-plain" [routerLink]="object.detailsPath">Подробнее</a>
        <a *ngIf="state !== 'process'" class="link-plain" [routerLink]="editPath">Редактировать</a>
      </ng-container>
      <ng-container *ngSwitchCase="'REESTR_INVALIDOV'">
        <a (click)="toggleForm()">Скачать PDF</a>
        <a (click)="delete()">Удалить</a>
      </ng-container>
      <ng-container *ngSwitchDefault>
        <ng-container *ngIf="state === ''">
          <a
            *ngIf="object.canDetails && object.detailsPath"
            class="link-plain"
            [queryParams]="object.detailsQueryParam ? object.detailsQueryParam : {}"
            [routerLink]="object.detailsPath"
          >{{object.detailsLinkTitle ? object.detailsLinkTitle : 'Подробнее'}}</a>
          <a *ngIf="object.canDetails && !object.detailsPath" (click)="toggleForm()">Подробнее</a>
          <a *ngIf="object.canEdit && !editPath" class="link-plain" (click)="toggleForm()">Редактировать</a>
          <a *ngIf="object.canEdit && editPath && state !== 'process'" class="link-plain" [queryParams]="editQueryParam ? editQueryParam : {}"
             [routerLink]="editPath">Редактировать</a>
          <a *ngIf="object.canDelete" class="link-plain" (click)="delete()">Удалить</a>
        </ng-container>
        <ng-container *ngIf="state !== '' && state !== 'verifying' && state !== 'failed'">
          <a *ngIf="isPassportNotification()" class="link-plain add-link" [href]="loadService.config.betaUrl + object.serviceUrl">{{object.full.orderTitle}}</a>
          <a *ngIf="object.canEdit && editPath" class="link-plain" [queryParams]="editQueryParam ? editQueryParam : {}"
             [routerLink]="editPath">Редактировать</a>
          <a *ngIf="editableInternal() && !editPath" class="link-plain" (click)="toggleForm()">Редактировать</a>
          <a *ngIf="editableExternal()"
             class="link-plain add-link"
             (click)="toExternalLink()"
          >Редактировать</a>
          <a *ngIf="showDetailButton()"
             class="link-plain"
             [routerLink]="object.detailsPath"
          >{{!isNotificationShow() || object.type === 'FRGN_PASS' || isExpiredDocDetails() ? 'Подробнее' : 'Редактировать'}}</a>
          <a *ngIf="object.canDetails && !object.detailsPath" (click)="toggleForm()">Подробнее</a>
          <a *ngIf="state === 'process'" class="link-plain add-link" (click)="cancelReq()">Отменить
            проверку</a>
          <a *ngIf="showRepeatButton()" class="link-plain add-link" (click)="repeatReq()">Повторить
            проверку</a>
          <a *ngIf="object.canDelete && !object.expired" class="link-plain" (click)="delete()">Удалить</a>
          <a *ngIf="object.expired && state !== 'process' && state !== 'error'" class="link-plain add-link" (click)="toOrder()">{{object.full.orderTitle}}</a>
        </ng-container>
        <ng-container *ngIf="!loadService.user.isKid && data.type === 'INN' && (data.vrfStu === 'VERIFIED' || data.vrfStu === 'NOT_VERIFIED')">
          <a *ngIf="state !== 'process' && state !== 'error'" class="link-plain" (click)="repeatReq()">{{data.number ? 'Обновить' : 'Запросить'}}</a>
          <a *ngIf="state === 'error'" class="link-plain add-link" (click)="repeatReq()">Повторить поиск</a>
          <a *ngIf="state === 'error'" class="link-plain add-link" (click)="toggleForm()">Ввести вручную</a>
        </ng-container>
        <ng-container *ngIf="data.type === 'KID_SNILS' && state === 'failed'">
          <a *ngIf="!data.number" class="link-plain add-link" (click)="repeatReq()">Повторить поиск</a>
          <a *ngIf="object.canEdit" class="link-plain" (click)="toggleForm()">{{data.number ? 'Редактировать' : 'Добавить'}}</a>
        </ng-container>
        <ng-container *ngIf="data.type === 'SELF_EMPLOYED'">
          <a *ngIf="object.canRepeat" class="link-plain" (click)="repeatReq()">
            {{state === 'error' ? 'Повторить поиск' : 'Обновить'}}
          </a>
          <a *ngIf="state === 'error'" class="link-plain" (click)="cancelReq()">Отменить</a>
        </ng-container>
      </ng-container>
    </ng-container>
  </div>
</ng-template>

<ng-template #modify>
  <div class="header">
    <div class="title">{{object.full.title}}</div>
  </div>
  <div>
    <ng-content></ng-content>
  </div>
</ng-template>

<div class="date-picker" [ngClass]="contextClass ? [contextClass] : []" (click)="returnFocus($event)" libClickOutside (clickOutside)="handleBlur(true);">
  <div *ngIf="!asSimplePanel" class="value-field-wrapper">
    <div class="value-field-container" #fieldContainer [ngClass]="{expanded: expanded, inconsistent: inconsistent}">
      <lib-standard-masked-input 
        #input 
        [(ngModel)]="text" 
        contextClass="calendar-input" 
        [name]="name" 
        [tabIndex]="tabIndex" 
        [disabled]="disabled" 
        [clearable]="clearable"
        [placeholder]="placeholder"
        [readOnly]="!textEditable || blockMobileKeyboard" 
        [mask]="isRange ? rangeMask : dateMask" 
        [showConstantMaskSymbols]="true" 
        [formatter]="dateEnteringController" 
        [removePlaceholderSymbols]="false"
        [keepCharPositions]="true" 
        [showMaskAsPlaceholder]="true" 
        [containerOverlap]="containerOverlap"
        (click)="toggle(true)" 
        (change)="handleChange($event.target.value)" 
        (focus)="handleFocus()" 
        (blur)="handleBlur(false)" 
        (cleared)="resetToEmpty()"
        [invalid]="invalid"
        [validation]="validation" 
        [validationShowOn]="validationShowOn"
        [validationMessages]="validationMessages" 
        [questionTip]="questionTip"
      ></lib-standard-masked-input>
      <div class="calendar-icon" (click)="toggle(false)"></div>
    </div>
  </div>
  <div class="calendar-wrapper" [ngClass]="{'simple-panel': asSimplePanel}">
    <div class="calendar-container" *ngIf="expanded || asSimplePanel" #calendarContainer (scroll)="stopPropagation($event)" (click)="hideMonthYearDropdowns($event);"
        [ngClass]="{'align-left': align === Align.LEFT, 'align-right': align === Align.RIGHT, 'adjust': align === Align.ADJUST}">
      <div class="calendar-panel">
        <div *ngIf="simplifiedMonthPanel" class="panel simplified-panel">
          <div class="month-buttons">
            <div class="month-arrow-prev" [ngClass]="{disabled: !prevMonthAvailable}"
              (click)="navigateToPreviousMonth()"></div>
          </div>
          <div class="current-month">{{activeMonth ? (activeMonth.text | libTranslate) : ''}}</div>
          <div class="month-buttons">
            <div class="month-arrow-next" [ngClass]="{disabled: !nextMonthAvailable}"
              (click)="navigateToNextMonth()"></div>
          </div>
        </div>
        <div *ngIf="!simplifiedMonthPanel" class="panel standard-panel">
          <div class="month-selector">
            <lib-simple-select #monthSelector 
              [list]="months" 
              [item]="activeMonth"
              [translation]="Translation.LIB"
              (changed)="navigateToMonth($event.item.id)">
            </lib-simple-select>
          </div>
          <div class="year-selector">
            <lib-simple-select #yearsSelector 
              [list]="years" 
              [item]="activeYear"
              (changed)="navigateToYear($event.item.id)">
            </lib-simple-select>
          </div>
          <div class="month-buttons">
            <div class="month-arrow-prev" [ngClass]="{disabled: !prevMonthAvailable}"
              (click)="navigateToPreviousMonth()"></div>
            <div class="month-arrow-next" [ngClass]="{disabled: !nextMonthAvailable}"
              (click)="navigateToNextMonth()"></div>
          </div>
        </div>
      </div>
      <div class="calendar-grip-container-wrapper" (touchstart)="startMonthDragging($event)">
        <div class="calendar-grid-container" #monthsFeed [@monthsSlider]="monthShift" (@monthsSlider.done)="handleMonthNavigationAnimationDone()">
          <div class="calendar-grid-wrap previous-month" [ngClass]="{'out-of-area': monthShift !== 'prev'}">
            <div class="calendar-grid">
              <div class="calendar-week-days">
                <div class="calendar-week-day" *ngFor="let weekDay of daysOfWeek">
                  <span class="calendar-week-day-text">{{weekDay | libTranslate}}</span>
                </div>
              </div>
              <div class="calendar-week" *ngFor="let week of prevWeeks">
                <div *ngFor="let day of week" [class]="day.custom" (click)="selectDate(day)" [ngClass]="{
                    'calendar-day': true,
                    'today': day.today,
                    'holiday': day.holiday,
                    'selected': day.selected,
                    'in-range': day.inRange,
                    'range-start': day.rangeStart,
                    'range-end': day.rangeEnd,
                    'locked': day.locked,
                    'outer': day.outer
                  }">
                  <span class="calendar-day-text">{{day ? day.day : ''}}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="calendar-grid-wrap current-month">
            <div class="calendar-grid">
              <div class="calendar-week-days">
                <div class="calendar-week-day" *ngFor="let weekDay of daysOfWeek">
                  <span class="calendar-week-day-text">{{weekDay | libTranslate}}</span>
                </div>
              </div>
              <div class="calendar-week" *ngFor="let week of weeks">
                <div *ngFor="let day of week" [class]="day.custom" (click)="selectDate(day)" [ngClass]="{
                    'calendar-day': true,
                    'today': day.today,
                    'holiday': day.holiday,
                    'selected': day.selected,
                    'in-range': day.inRange,
                    'range-start': day.rangeStart,
                    'range-end': day.rangeEnd,
                    'locked': day.locked,
                    'outer': day.outer
                  }">
                  <span class="calendar-day-text">{{day ? day.day : ''}}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="calendar-grid-wrap next-month" [ngClass]="{'out-of-area': monthShift !== 'next'}">
            <div class="calendar-grid" >
              <div class="calendar-week-days">
                <div class="calendar-week-day" *ngFor="let weekDay of daysOfWeek">
                  <span class="calendar-week-day-text">{{weekDay | libTranslate}}</span>
                </div>
              </div>
              <div class="calendar-week" *ngFor="let week of nextWeeks">
                <div *ngFor="let day of week" [class]="day.custom" (click)="selectDate(day)" [ngClass]="{
                    'calendar-day': true,
                    'today': day.today,
                    'holiday': day.holiday,
                    'selected': day.selected,
                    'in-range': day.inRange,
                    'range-start': day.rangeStart,
                    'range-end': day.rangeEnd,
                    'locked': day.locked,
                    'outer': day.outer
                  }">
                  <span class="calendar-day-text">{{day ? day.day : ''}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

#**Как запускать либу и лк в режиме watch mode:**

1. Отводим ветку от branch-prod-fed.
2. Заходим в папку dist/epgu-lib и из под этого пути в терминале выполняем npm link (отлинковать можно так: npm unlink).
3. Делаем сборку либы и одновременно watch: npm run lib-watch. 
   После того как сборка прошла запускаем команду npm run cp-lib-assets 
   (чтобы assets в dist подцепились - хорошо бы это сделать как-то по-другому - задача на подумать).
4. Открываем нужный проект, свою ветку, выполняем npm i (если нужно).
5. Из под корня epgu-app в терминале выполняем команду: npm link @epgu/epgu-lib
6. Запускаем проект как обычно (к примеру, app-server:serve и lk-client:serve)
7. Если все прошло успешно сейчас папка epgu-lib в node_modules должна смотреть на проект epgu-lib, тот, что в новом репозитории. 
   Меняем что-нибудь в проекте epgu-lib - выполняется автоматом била либы и изменения подтягиваются сразу в лк, так как там запущен serve и стоил link на epgu-lib
8. Поднятие версий либы работает абсолютно также, но из под проекта epgu-lib. 
   Папка epgu-lib в apgu-app более не нужна, поэтому я ее удалил в EPGUCORE-LIB.
   
#Правила публикации либы:
   Один раз выполнить эти команды для регистрации:
   npm set registry http://npm.gosuslugi.local
   npm adduser --registry http://npm.gosuslugi.local
   
   В branch-prod-fed хранится продовская версия либы.
   
   Создание ветки для эпиков/тикетов:
   1. Отводимся от branch-prod-fed
   2. Правим либу
   3. Публикуем из ветки своей.
   
   Для вывода в прод:
   1. Мержим ветку в релизную ветку.
   2. Публикуем из релизной ветки.
   
   Публикация:
   
   Проверяем:
   1. что ветка собирается через ng build --project=epgu-lib, проверяем что ветка не содержит ошибок линта ng lint --project=epgu-lib.
   2. Повышаем версию либы: в package.json version (3 строчка), npm version +1 от текущей (например была 0.0.69 => ставим 0.0.70, текущую версию можно посмотреть http://npm.gosuslugi.local/-/web/detail/epgu-lib)
   3. Билдим либу: npm run lib-build:prod
   4. Публикуем: переходим в dist/epgu-lib, выполняем npm publish
   5. Если в процессе публикации вылетела ошибка "Can not publish over existing version" - возвращаемся к п. 1
   6. Делаем коммит с указанием версии опубликованной либы и пуш. Пишем в чате что повысили версию либы.
   7. В проекте в папке epgu-app в package.json в devDependencies меняем версию "epgu-lib" на ту, что вы только что опубликовали (например "epgu-lib": 0.0.70 как в примере выше).
   

#**epgu-portal**

Сначала делаем билд портала:
```
npm run portal-build:prod
```
В файле config.js устанавливаем значение поля:
```
viewType: "PORTAL" 
```
Далее в зависимости от того какая часть нужна для разаработки клиентская или серверная, следуем одной из двух интсрукций:

1.Запуск серверной части и клиентской одновременно. при этом сервер nodejs полноценно отдает все данные через pug. Запускать необходимо при условии, что вам нужно делать изменения в серверной части express (при этом менять серверные файлы с последующим автоапдейтом можно только в dist...):
```
npm run app-server:serve
```
2.Запуск клиентской части и серверной части. При этом сервер nodejs будет работать как api. Запускать необходимо при условии, что вам нужно делать изменения в клиентской части приложения:
```
npm run portal-client:serve
npm run app-server:serve
```
--------------------
Для production. 
Сборка production:
```
npm run portal-build:prod
```
Старт портала в режиме кластеризации в режиме production (нужен глобальный pm2):
```
npm run app-run
```
#**epgu-lk**

Сначала делаем билд лк:
```
npm run lk-build:prod
```
В файле config.js устанавливаем значение поля:
```
viewType: "LK" 
```
Далее в зависимости от того какая часть нужна для разаработки клиентская или серверная, следуем одной из двух интсрукций:

1.Запуск серверной части и клиентской одновременно. при этом сервер nodejs полноценно отдает все данные через pug. Запускать необходимо при условии, что вам нужно делать изменения в серверной части express:
```
npm run lk-client:watch
npm run app-server:watch
```
2.Запуск клиентской части и серверной части. При этом сервер nodejs будет работать как api. Запускать необходимо при условии, что вам нужно делать изменения в клиентской части приложения:
```
npm run lk-client:serve
npm run app-server:serve
```
3.Для IE необходимо проделать следующее:
```
В файле проекта tsconfig.app.json добавить в compilerOptions 
"target": "es5"
!Затем вернуть как было!
```
--------------------
Для production. 
Сборка production:
```
npm run lk-build:prod
```
Старт портала в режиме кластеризации в режиме production (нужен глобальный pm2):
```
npm run app-run
```
Сборка для нескольких сред в режиме прод:
```
npm run build-all
```

#**epgu-partners**

Сначала делаем билд партнеров:
```
npm run partners-build:prod
```
В файле config.js устанавливаем значение поля:
```
viewType: "PARTNERS" 
```
Далее в зависимости от того какая часть нужна для разаработки клиентская или серверная, следуем одной из двух интсрукций:

1.Запуск серверной части и клиентской одновременно. при этом сервер nodejs полноценно отдает все данные через pug. Запускать необходимо при условии, что вам нужно делать изменения в серверной части express:
```
npm run partners-client:watch
npm run app-server:watch
```
2.Запуск клиентской части и серверной части. При этом сервер nodejs будет работать как api. Запускать необходимо при условии, что вам нужно делать изменения в клиентской части приложения:
```
npm run partners-client:serve
npm run app-server:serve
```
--------------------
Для production. 
Сборка production:
```
npm run partners-build:prod
```
Старт портала в режиме кластеризации в режиме production (нужен глобальный pm2):
```
npm run app-run
```

#**epgu-payment**

Сначала делаем билд payment:
```
npm run payment-build:prod
```
В файле config.js устанавливаем значение поля:
```
viewType: "PAYMENT" 
```
Далее в зависимости от того какая часть нужна для разаработки клиентская или серверная, следуем одной из двух интсрукций:

1.Запуск серверной части и клиентской одновременно. при этом сервер nodejs полноценно отдает все данные через pug. Запускать необходимо при условии, что вам нужно делать изменения в серверной части express:
```
npm run payment-client:watch
npm run app-server:watch
```
2.Запуск клиентской части и серверной части. При этом сервер nodejs будет работать как api. Запускать необходимо при условии, что вам нужно делать изменения в клиентской части приложения:
```
npm run payment-client:serve
npm run app-server:serve
```
3.Для IE необходимо проделать следующее:
```
В файле проекта tsconfig.app.json добавить в compilerOptions 
"target": "es5"
!Затем вернуть как было!
```

--------------------
Для production. 
Сборка production:
```
npm run payment-build:prod
```
Старт портала в режиме кластеризации в режиме production (нужен глобальный pm2):
```
npm run app-run
```

Сборка для нескольких сред в режиме прод:
```
npm run build-all-payment
```

<lib-throbber *ngIf="feedsIsLoading" [defaultHeaders]="true"></lib-throbber>
<div>
  <div (click)="onFeedGepsClick()" class="feed-item" *ngFor="let feed of feedItems ; let i = index ; trackBy: trackById"
       [ngClass]="{'banner-item': !isFeedModel(feed), 'hidden': feed.closed || archived}">
    <ng-container *ngIf="!archived">
      <ng-container *ngTemplateOutlet="isFeedModel(feed) ? feedContent : bannerContent; context: {feed: feed}"></ng-container>
    </ng-container>
    <ng-container *ngIf="isFeedModel(feed) && archived">
      <ng-container *ngTemplateOutlet="feedContent; context: {feed: feed}"></ng-container>
    </ng-container>
  </div>
</div>
<div *ngIf="enableShowMoreButton()" class="mt-32 mb-32">
  <span class="small-text blue link-underline" (click)="showMore()">{{'MESSAGES.SHOW_MORE' | libTranslate}}</span>
</div>

<lib-throbber *ngIf="addFeedsIsLoading" [defaultHeaders]="true"></lib-throbber>

<div *ngIf="isFeedsEmpty()" class="empty-feeds text-plain black">
  <ng-container *ngIf="feedsNotExistsByFilter; else emptyFeeds">
    {{'MESSAGES.NOT_FOUND' | libTranslate}}
  </ng-container>
  <ng-template #emptyFeeds>
    <div class="mb-16">{{'MESSAGES.NO_MESSAGES' | libTranslate}}</div>
  </ng-template>
</div>

<ng-template #feedContent let-feed="feed">
  <div class="details-link flex-container-md flex-container-lg" [routerLink]="['/message/' + feed.id]">
    <a class="feed-link flex-container">
      <div class="feed-icon" (click)="$event.stopPropagation()">
        <lib-checkbox
          [(ngModel)]="feed.selected"
        ></lib-checkbox>
      </div>
      <div class="flex-1 flex-container-lg flex-container-md feed-content">
        <div>
          <div class="flex-container">
            <div *ngIf="markAsFlag(feed)" class="red-flag mt-4"></div>
            <h4 class="normal black text-plain mb-4" [ngClass]="{'bold': setUnreadFeedCls(feed)}" [innerHTML]="feed.subTitle | highlight: search"></h4>
          </div>
          <p class="feed-subheader" [innerHTML]="(feed.status === 'outbox' && feed.data?.deptMessageType === 'ORDER'? feed.data?.toName || feed.title : feed.title) | highlight: search"></p>
        </div>
      </div>
    </a>
    <a class="flex-1-0-md flex-1-0-lg">
      <div class="feed-item-controls mt-8">
        <div class="flex-container feed-item-controls-buttons align-items-center">
          <div class="details hide show-md" *ngIf="getAmount(feed) as amount">
            <p class="title-h6">{{amount}} <span class="rub-bold black">ла</span></p>
          </div>
          <div class="details hide show-md" *ngIf="isAttach(feed)">
            <div class="attach-icon"></div>
          </div>
          <div [ngClass]="setClsDateByUnread(feed)" *ngIf="showFeedDate(feed)" class="feed-item-date details">
            <div class="date" [innerHTML]="feed.date | timeToEventGeps: false : true"></div>
            <div class="date-mobile" [innerHTML]="feed.date | timeToEventGeps: true : true"></div>
          </div>
        </div>
      </div>
    </a>
  </div>
</ng-template>

<ng-template #bannerContent let-feed="feed">
  <div class="details-link flex-container-md flex-container-lg">
    <div class="flex-1">
      <lib-static-banner [isGeps]="true"
                         [needContainer]="false"
                         (click)="onBannerClick(feed.path)"
                         [banners]="banners"
                         [path]="feed.path"
                         (close)="onCloseBanner(feed)"></lib-static-banner>
    </div>
  </div>
</ng-template>


